{"version":3,"sources":["../src/formelements.js"],"names":["define","$","str","init","getMessage","messageString","get_string","when","done","s","append","parent","child","children","hide","selectorCheckbox","checkboxInitialValue","prop","createDiv","div","attr","ready","whenTrue","evaluateFunction","maxIterations","prom","Deferred","i","checker","setInterval","reject","clearInterval","resolve","promise","isElementDisabled","then","printSettings","removeAttr"],"mappings":"AA0BAA,OAAM,sCAAC,CAAC,QAAD,CAAW,UAAX,CAAD,CAAyB,SAASC,CAAT,CAAYC,CAAZ,CAAiB,CAE5C,MAAO,CAKHC,IAAI,CAAE,eAAW,IAeTC,CAAAA,CAAU,CAAG,UAAW,CAGxB,GAAIC,CAAAA,CAAa,CAAGH,CAAG,CAACI,UAAJ,CAAe,6BAAf,CAA8C,uBAA9C,CAApB,CAEAL,CAAC,CAACM,IAAF,CAAOF,CAAP,EAAsBG,IAAtB,CAA2B,SAASC,CAAT,CAAY,CACnCR,CAAC,CAAC,yBAAD,CAAD,CAA6BS,MAA7B,CAAoCD,CAApC,CACH,CAFD,CAIH,CAxBY,CA4ETE,CAAM,CAAGV,CAAC,CAAC,oBAAD,CA5ED,CA+ETW,CAAK,CAAGD,CAAM,CAACE,QAAP,CAAgB,KAAhB,EAAuBC,IAAvB,EA/EC,CAkFTC,CAAgB,CAAGd,CAAC,CAAC,wBAAD,CAlFX,CAmFTe,CAAoB,CAAGD,CAAgB,CAACE,IAAjB,CAAsB,SAAtB,CAnFd,CAoFbF,CAAgB,CAACE,IAAjB,CAAsB,SAAtB,KACAF,CAAgB,CAACE,IAAjB,CAAsB,UAAtB,KAEA,CAlFgB,QAAZC,CAAAA,SAAY,EAAW,CACvB,GAAIC,CAAAA,CAAG,CAAGlB,CAAC,CAAC,aAAD,CAAD,CAAiBmB,IAAjB,CAAsB,OAAtB,CAA+BR,CAAK,CAACQ,IAAN,CAAW,OAAX,CAA/B,CAAV,CACAD,CAAG,CAACC,IAAJ,CAAS,IAAT,CAAe,wBAAf,EACAT,CAAM,CAACD,MAAP,CAAcS,CAAd,EACAf,CAAU,EACb,CA6ED,IAEA,GAAIiB,CAAAA,CAAK,CAjDM,QAAXC,CAAAA,QAAW,CAASC,CAAT,CAA2BC,CAA3B,CAA0C,CACrDA,CAAa,CAAG,CAACA,CAAD,CAAiB,EAAjB,CAAsBA,CAAtC,CADqD,GAGjDC,CAAAA,CAAI,CAAGxB,CAAC,CAACyB,QAAF,EAH0C,CAIjDC,CAAC,CAAG,CAJ6C,CAKjDC,CAAO,CAAGC,WAAW,CAAC,UAAW,CACjCF,CAAC,CAAGA,CAAC,CAAG,CAAR,CACA,GAAIA,CAAC,CAAGH,CAAR,CAAuB,CACnBC,CAAI,CAACK,MAAL,GACAC,aAAa,CAACH,CAAD,CAChB,CAHD,IAGO,CACH,GAAIL,CAAgB,EAApB,CAAwB,CACpBE,CAAI,CAACO,OAAL,GACAD,aAAa,CAACH,CAAD,CAChB,CACJ,CACJ,CAXwB,CAWtB,GAXsB,CAL4B,CAkBrD,MAAOH,CAAAA,CAAI,CAACQ,OAAL,EACV,CA8BW,CA3DY,QAApBC,CAAAA,iBAAoB,EAAW,CAC/B,MAAOjC,CAAAA,CAAC,CAAC,iCAAD,CAAD,CAAqCgB,IAArC,CAA0C,UAA1C,CACV,CAyDW,CAA4B,EAA5B,CAAZ,CACAI,CAAK,CAACc,IAAN,CA1BoB,QAAhBC,CAAAA,aAAgB,EAAW,CAC3B,GAAIjB,CAAAA,CAAG,CAAGlB,CAAC,CAAC,yBAAD,CAAX,CACAkB,CAAG,CAACL,IAAJ,GACAF,CAAK,CAACyB,UAAN,CAAiB,OAAjB,EACAtB,CAAgB,CAACE,IAAjB,CAAsB,SAAtB,CAAiCD,CAAjC,EACAD,CAAgB,CAACE,IAAjB,CAAsB,UAAtB,KACA,GAAID,CAAJ,CAA0B,CACtBf,CAAC,CAAC,mCAAD,CAAD,CAAuCgB,IAAvC,CAA4C,UAA5C,KACAhB,CAAC,CAAC,iCAAD,CAAD,CAAqCgB,IAArC,CAA0C,UAA1C,IACH,CACJ,CAgBD,CAEH,CAjGE,CAmGV,CArGK,CAAN","sourcesContent":["/**\n * This file is part of Moodle - http://moodle.org/\n *\n * Moodle is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Moodle is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n *\n * @package   plagiarism_safeassign\n * @author    Guillermo Leon Alvarez Salamanca\n * @copyright Copyright (c) 2017 Open LMS (https://www.openlms.net)\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * JS code to disable temporarily the SafeAssign settings parameters in module edit from\n * until the page ends to load all the elements on it.\n */\ndefine(['jquery', 'core/str'], function($, str) {\n\n    return {\n\n        /**\n         * Hides via javascript the form elements until page is ready.\n         */\n        init: function() {\n\n            /**\n             * Create a div to display the loading message inside module edit form.\n             */\n            var createDiv = function() {\n                var div = $('<div></div>').attr('class', child.attr('class'));\n                div.attr('id', 'safeassign_loading_div');\n                parent.append(div);\n                getMessage();\n            };\n\n            /**\n             * Returns a string with the loading message.\n             */\n            var getMessage = function() {\n\n                // Get loading message via ajax.\n                var messageString = str.get_string('safeassign_loading_settings', 'plagiarism_safeassign');\n\n                $.when(messageString).done(function(s) {\n                    $('#safeassign_loading_div').append(s);\n                });\n\n            };\n\n            /**\n             * Checks if the element is disabled.\n             * @returns {boolean}\n             */\n            var isElementDisabled = function() {\n                return $('#id_safeassign_global_reference').prop('disabled');\n            };\n\n            /**\n             * Makes a JQuery promise to see if some element is disabled.\n             * @param {function} evaluateFunction\n             * @param {int} maxIterations\n             * @returns {promise} JQuery promise\n             */\n            var whenTrue = function(evaluateFunction, maxIterations) {\n                maxIterations = !maxIterations ? 10 : maxIterations;\n\n                var prom = $.Deferred();\n                var i = 0;\n                var checker = setInterval(function() {\n                    i = i + 1;\n                    if (i > maxIterations) {\n                        prom.reject();\n                        clearInterval(checker);\n                    } else {\n                        if (evaluateFunction()) {\n                            prom.resolve();\n                            clearInterval(checker);\n                        }\n                    }\n                }, 1000);\n\n                return prom.promise();\n            };\n\n            /**\n             * Print the settings checkboxes when tha page has been loaded.\n             */\n            var printSettings = function() {\n                var div = $('#safeassign_loading_div');\n                div.hide();\n                child.removeAttr('style');\n                selectorCheckbox.prop('checked', checkboxInitialValue);\n                selectorCheckbox.prop('disabled', false);\n                if (checkboxInitialValue) {\n                    $('#id_safeassign_originality_report').prop('disabled', false);\n                    $('#id_safeassign_global_reference').prop('disabled', false);\n                }\n            };\n\n            var parent = $('#id_plagiarismdesc');\n\n            // Hide the settings for SafeAssign in the module edit form.\n            var child = parent.children('div').hide();\n\n            // Disable SafeAssign enable settings.\n            var selectorCheckbox = $('#id_safeassign_enabled');\n            var checkboxInitialValue = selectorCheckbox.prop('checked');\n            selectorCheckbox.prop('checked', false);\n            selectorCheckbox.prop('disabled', true);\n\n            createDiv();\n\n            var ready = whenTrue(isElementDisabled, 30);\n            ready.then(printSettings);\n\n        }\n    };\n});\n"],"file":"formelements.min.js"}